"use strict";angular.module("edeliveryApp",["ui.bootstrap","ui.chart","ngGrid","ngCookies","ngResource","ngSanitize","ngRoute","monthlyService","weeklyService","dailyService","indexService","indexControllers","monthlyControllers","weeklyControllers","dailyControllers","edeliveryControllers","activityService","utilService","auth0","authInterceptor"]).config(["$routeProvider","authProvider",function(a,b){a.when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/daily/:dt/:category",{templateUrl:"views/daily.html",controller:"DailyCtrl",loadedView:"daily"}).when("/weekly/:dt/:category",{templateUrl:"views/weekly.html",controller:"WeeklyCtrl",loadedView:"weekly"}).when("/monthly/:dt/:category",{templateUrl:"views/monthly.html",controller:"MonthlyCtrl",loadedView:"monthly"}).when("/logout",{templateUrl:"views/logout.html",controller:"LogoutCtrl"}).otherwise({redirectTo:"/login"}),b.init({domain:"mikenewlin.auth0.com",clientID:"Bl2CaO5KvF36RoOHJmdPJUdIcWZOGMoY",callbackURL:"http://newlin-demo.herokuapp.com/",callbackOnLocationHash:!0})}]);var indexControllers=angular.module("indexControllers",[]);indexControllers.controller("LoginCtrl",["$rootScope","$scope","auth",function(a,b,c){a.$on("auth:forbidden",function(){c.signout(),$location.path("/login")}),c.signin()}]),indexControllers.controller("LogoutCtrl",["$scope","auth","$location",function(a,b,c){b.signout(),c.path("/login")}]),indexControllers.controller("NavCtrl",["$scope","$route","$location","ServiceCategories","Activity",function(a,b,c,d,e){a.hasActivity=function(){return e.hasActivity()},a.isActive=function(a){if(!b.current)return!1;var c=a===b.current.loadedView;return c},a.today=function(){a.dt=new Date,a.$watch("dt",function(){b.current&&("daily"==b.current.loadedView&&c.path("/daily/"+a.dt+"/"+a.category),"monthly"==b.current.loadedView&&c.path("/monthly/"+a.dt+"/"+a.category),"weekly"==b.current.loadedView&&c.path("/weekly/"+a.dt+"/"+a.category))})},a.today(),a.categories=d.query(),a.category="All",a.$watch("category",function(){b.current&&("daily"==b.current.loadedView&&c.path("/daily/"+a.dt+"/"+a.category),"monthly"==b.current.loadedView&&c.path("/monthly/"+a.dt+"/"+a.category),"weekly"==b.current.loadedView&&c.path("/weekly/"+a.dt+"/"+a.category))}),a.showWeeks=!0,a.toggleWeeks=function(){a.showWeeks=!a.showWeeks},a.clear=function(){a.dt=null},a.disabled=function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},a.toggleMin=function(){a.minDate=a.minDate?null:new Date},a.toggleMin(),a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.dateOptions={"year-format":"'yy'","starting-day":0},a.format="dd-MMMM-yyyy"}]);var edeliveryControllers=angular.module("edeliveryControllers",[]);edeliveryControllers.controller("MainCtrl",["$scope","DayTotalsList","DateUtil","Activity","auth",function(a,b,c,d,e){a.user=e.profile,d.setLastViewed(new Date),a.today=c.dateFormat(new Date,"MM-DD-YYYY"),a.lastload=d.getLastUpdate().toLocaleString();var f=c.dateFormat(new Date,"YYYYMMDD");a.myData=[],b.get({date:f},function(b){a.myData=b.listing,a.delivered=b.delivered_totals,a.failed=b.failed_totals}),a.gridOptions={data:"myData",columnDefs:[{field:"category_description",displayName:"Category",width:"15%"},{field:"service_description",displayName:"Service",width:"25%"},{field:"delivery_exception",displayName:"Exception",width:"48%",cellTemplate:'<div ng-class="{red: row.getProperty(col.field).length > 0}"><div class="ngCellText">{{row.getProperty(col.field)}}</div></div>'},{field:"total",displayName:"Total",width:"10%"}]}}]);var dailyControllers=angular.module("dailyControllers",[]);dailyControllers.controller("DailyCtrl",["$scope","DailyCategoryTotals","DailyCategoryFailedTotals","DailyServiceTotals","DailyServiceFailedTotals","DailyFailedReasonTotals","DateUtil","$routeParams","Activity","ActivityService",function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c,d){return d.series[b].label+", "+d.data[b][c]}function l(b){a.chart=b.dailytotals,a.chartOptions={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b.category,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b.days}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:k}}}function m(b){a.chart2=b.dailytotals,a.chartOptions2={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b.category,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b.days}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:k}}}function n(b){a.chart3=b.dailytotals,a.chartOptions3={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b.exception,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b.days}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:k}}}j.get(function(a){i.setLastUpdate(a.last_update)});var o=new Date(h.dt);a.category=h.category,a.weekStart=g.dateFormat(g.weekStart(o),"MM-DD-YYYY");var p=g.dateFormat(g.weekStart(o),"YYYYMMDD");"All"==h.category?(b.get({weekstart:p},function(b){a.deliverytotal=b.totals,b.totals>0?(a.isopen1=!0,l(b)):a.isopen1=!1}),c.get({weekstart:p},function(b){a.faileddeliverytotal=b.totals,b.totals>0?(a.isopen2=!0,m(b)):a.isopen2=!1})):(d.get({weekstart:p,category:h.category},function(b){a.deliverytotal=b.totals,b.totals>0?(a.isopen1=!0,l(b)):a.isopen1=!1}),e.get({weekstart:p,category:h.category},function(b){a.faileddeliverytotal=b.totals,b.totals>0?(a.isopen2=!0,m(b)):a.isopen2=!1})),f.get({weekstart:p,category:h.category},function(b){a.failedreasonstotal=b.totals,b.totals>0?(a.isopen3=!0,n(b)):a.isopen3=!1})}]);var weeklyControllers=angular.module("weeklyControllers",[]);weeklyControllers.controller("WeeklyCtrl",["$scope","WeeklyCategoryTotals","WeeklyCategoryFailedTotals","WeeklyServiceTotals","WeeklyServiceFailedTotals","WeeklyFailedReasonTotals","DateUtil","$routeParams","Activity","ActivityService",function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c,d){return d.series[b].label+", "+d.data[b][c]}function l(b){a.chart=b.weeklytotals,a.chartOptions={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b.category,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b.weekstart}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:k}}}function m(b){a.chart2=b.weeklytotals,a.chartOptions2={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b.category,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b.weekstart}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:k}}}function n(b){a.chart3=b.weeklytotals,a.chartOptions3={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b.exception,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b.weekstart}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:k}}}a.isopen1=!0,a.isopen2=!0,a.isopen3=!0,j.get(function(a){i.setLastUpdate(a.last_update)});var o=new Date(h.dt);a.category=h.category,a.date=o,a.year=o.getFullYear(),a.month=o.getMonth()+1,a.monthyear=g.dateFormat(o,"MM-YYYY"),"All"==h.category?(b.get({year:o.getFullYear(),month:o.getMonth()+1},function(b){a.deliverytotal=b.totals,b.totals>0?(a.isopen1=!0,l(b)):a.isopen1=!1}),c.get({year:o.getFullYear(),month:o.getMonth()+1},function(b){a.faileddeliverytotal=b.totals,b.totals>0?(a.isopen2=!0,m(b)):a.isopen2=!1})):(d.get({year:o.getFullYear(),month:o.getMonth()+1,category:h.category},function(b){a.deliverytotal=b.totals,b.totals>0?(a.isopen1=!0,l(b)):a.isopen1=!1}),e.get({year:o.getFullYear(),month:o.getMonth()+1,category:h.category},function(b){a.faileddeliverytotal=b.totals,b.totals>0?(a.isopen2=!0,m(b)):a.isopen2=!1})),f.get({year:o.getFullYear(),month:o.getMonth()+1,category:h.category},function(b){a.failedreasonstotal=b.totals,b.totals>0?(a.isopen3=!0,n(b)):a.isopen3=!1})}]);var monthlyControllers=angular.module("monthlyControllers",[]);monthlyControllers.controller("MonthlyCtrl",["$scope","MonthlyCategoryTotals","MonthlyCategoryFailedTotals","MonthlyServiceTotals","MonthlyServiceFailedTotals","MonthlyFailedReasonTotals","$routeParams","Activity","ActivityService",function(a,b,c,d,e,f,g,h,i){function j(a,b,c,d){return d.series[b].label+", "+d.data[b][c]}function k(b){a.chart=b.monthlytotals,a.chartOptions={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b.category,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b.months}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:j}}}function l(b){a.chart2=b.monthlytotals,a.chartOptions2={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b.category,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b.months}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:j}}}function m(b){a.chart3=b.monthlytotals,a.chartOptions3={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b.exception,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b.months}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:j}}}a.isopen1=!0,a.isopen2=!0,a.isopen3=!0,i.get(function(a){h.setLastUpdate(a.last_update)});var n=new Date(g.dt);a.category=g.category,a.year=n.getFullYear(),"All"==g.category?(b.get({year:n.getFullYear()},function(b){a.deliverytotal=b.totals,b.totals>0?(a.isopen1=!0,k(b)):a.isopen1=!1}),c.get({year:n.getFullYear()},function(b){a.faileddeliverytotal=b.totals,b.totals>0?(a.isopen2=!0,l(b)):a.isopen2=!1})):(d.get({year:n.getFullYear(),category:g.category},function(b){a.deliverytotal=b.totals,b.totals>0?(a.isopen1=!0,k(b)):a.isopen1=!1}),e.get({year:n.getFullYear(),category:g.category},function(b){a.faileddeliverytotal=b.totals,b.totals>0?(a.isopen2=!0,l(b)):a.isopen2=!1})),f.get({year:n.getFullYear(),category:g.category},function(b){a.failedreasonstotal=b.totals,b.totals>0?(a.isopen3=!0,m(b)):a.isopen3=!1})}]);var monthlyService=angular.module("monthlyService",["ngResource"]);monthlyService.factory("MonthlyCategoryTotals",["$resource",function(a){return a("api/monthlytotalsbycategory/:year",{},{})}]),monthlyService.factory("MonthlyCategoryFailedTotals",["$resource",function(a){return a("api/monthlyfailedtotalsbycategory/:year",{},{})}]),monthlyService.factory("MonthlyServiceTotals",["$resource",function(a){return a("api/monthlytotalsbyservice/:year/:category",{},{})}]),monthlyService.factory("MonthlyServiceFailedTotals",["$resource",function(a){return a("api/monthlyfailedtotalsbyservice/:year/:category",{},{})}]),monthlyService.factory("MonthlyFailedReasonTotals",["$resource",function(a){return a("api/monthlyfailedreasontotalsbyexception/:year/:category",{},{})}]);var weeklyService=angular.module("weeklyService",["ngResource"]);weeklyService.factory("WeeklyCategoryTotals",["$resource",function(a){return a("api/weeklytotalsbycategory/:year/:month",{},{})}]),weeklyService.factory("WeeklyCategoryFailedTotals",["$resource",function(a){return a("api/weeklyfailedtotalsbycategory/:year/:month",{},{})}]),weeklyService.factory("WeeklyServiceTotals",["$resource",function(a){return a("api/weeklytotalsbyservice/:year/:month/:category",{},{})}]),weeklyService.factory("WeeklyServiceFailedTotals",["$resource",function(a){return a("api/weeklyfailedtotalsbyservice/:year/:month/:category",{},{})}]),weeklyService.factory("WeeklyFailedReasonTotals",["$resource",function(a){return a("api/weeklyfailedreasontotalsbyexception/:year/:month/:category",{},{})}]);var dailyService=angular.module("dailyService",["ngResource"]);dailyService.factory("DailyCategoryTotals",["$resource",function(a){return a("api/dailytotalsbycategory/:weekstart",{},{})}]),dailyService.factory("DailyCategoryFailedTotals",["$resource",function(a){return a("api/dailyfailedtotalsbycategory/:weekstart",{},{})}]),dailyService.factory("DailyServiceTotals",["$resource",function(a){return a("api/dailytotalsbyservice/:weekstart/:category",{},{})}]),dailyService.factory("DailyServiceFailedTotals",["$resource",function(a){return a("api/dailyfailedtotalsbyservice/:weekstart/:category",{},{})}]),dailyService.factory("DailyFailedReasonTotals",["$resource",function(a){return a("api/dailyfailedreasontotalsbyexception/:weekstart/:category",{},{})}]),dailyService.factory("DayTotalsList",["$resource",function(a){return a("api/daytotalslisting/:date",{},{})}]);var indexService=angular.module("indexService",["ngResource"]);indexService.factory("ServiceCategories",["$resource",function(a){return a("api/servicecategories",{},{})}]),indexService.factory("Services",["$resource",function(a){return a("api/services",{},{})}]);var app=angular.module("utilService",[]);app.service("DateUtil",function(){this.dateFormat=function(a,b){return b=b.replace("DD",(a.getDate()<10?"0":"")+a.getDate()),b=b.replace("MM",(a.getMonth()<9?"0":"")+(a.getMonth()+1)),b=b.replace("YYYY",a.getFullYear())},this.weekStart=function(a){var b=a.getFullYear(),c=a.getMonth(),d=a.getDate()-a.getDay();d>a.getDate()&&(c--,0==a.getMonth()&&b--);var e=new Date;return e.setFullYear(b),e.setMonth(c),e.setDate(d),e},this.weekEnd=function(a){var b=a.getFullYear(),c=a.getMonth(),d=a.getDate()+(6-a.getDay());d<a.getDate()&&(c++,12==a.getMonth()&&b++);var e=new Date;return e.setFullYear(b),e.setMonth(c),e.setDate(d),e}});var app=angular.module("activityService",["ngResource"]);app.service("Activity",function(){var a=new Date,b=new Date;return{getLastUpdate:function(){return a},getLastViewed:function(){return b},setLastUpdate:function(b){a=new Date(b)},setLastViewed:function(a){b=a},hasActivity:function(){return a>b}}}),app.factory("ActivityService",["$resource",function(a){return a("api/historyactivity",{},{})}]);