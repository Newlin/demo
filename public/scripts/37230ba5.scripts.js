"use strict";angular.module("edeliveryApp",["ui.bootstrap","ui.chart","ngCookies","ngResource","ngSanitize","ngRoute","monthlyService","weeklyService","dailyService","indexService","indexControllers","monthlyControllers","weeklyControllers","dailyControllers","edeliveryControllers","utilService"]).config(["$routeProvider",function(a){a.when("/main",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/daily/:dt/:category",{templateUrl:"views/daily.html",controller:"DailyCtrl",loadedView:"daily"}).when("/weekly/:dt/:category",{templateUrl:"views/weekly.html",controller:"WeeklyCtrl",loadedView:"weekly"}).when("/monthly/:dt/:category",{templateUrl:"views/monthly.html",controller:"MonthlyCtrl",loadedView:"monthly"}).otherwise({redirectTo:"/main"})}]);var indexControllers=angular.module("indexControllers",[]);indexControllers.controller("NavCtrl",["$scope","$route","$location","ServiceCategories",function(a,b,c,d){a.isActive=function(a){if(!b.current)return!1;var c=a===b.current.loadedView;return c},a.today=function(){a.dt=new Date,a.$watch("dt",function(){b.current&&("daily"==b.current.loadedView&&c.path("/daily/"+a.dt+"/"+a.category),"monthly"==b.current.loadedView&&c.path("/monthly/"+a.dt+"/"+a.category),"weekly"==b.current.loadedView&&c.path("/weekly/"+a.dt+"/"+a.category))})},a.today(),a.categories=d.query(),a.category="All",a.$watch("category",function(){b.current&&("daily"==b.current.loadedView&&c.path("/daily/"+a.dt+"/"+a.category),"monthly"==b.current.loadedView&&c.path("/monthly/"+a.dt+"/"+a.category),"weekly"==b.current.loadedView&&c.path("/weekly/"+a.dt+"/"+a.category))}),a.showWeeks=!0,a.toggleWeeks=function(){a.showWeeks=!a.showWeeks},a.clear=function(){a.dt=null},a.disabled=function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},a.toggleMin=function(){a.minDate=a.minDate?null:new Date},a.toggleMin(),a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.dateOptions={"year-format":"'yy'","starting-day":0},a.format="dd-MMMM-yyyy"}]);var edeliveryControllers=angular.module("edeliveryControllers",[]);edeliveryControllers.controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);var dailyControllers=angular.module("dailyControllers",[]);dailyControllers.controller("DailyCtrl",["$scope","DailyCategoryTotals","DailyCategoryFailedTotals","DailyServiceTotals","DailyServiceFailedTotals","DailyFailedReasonTotals","DateUtil","$routeParams","$q",function(a,b,c,d,e,f,g,h,i){function j(a,b,c,d){return d.series[b].label+", "+d.data[b][c]}function k(a,c){var e,f=i.defer();return e="All"==c?b.get({weekstart:a},function(){f.resolve(e)}):d.get({weekstart:a,category:c},function(){f.resolve(e)}),f.promise}function l(a,b){var d,f=i.defer();return d="All"==b?c.get({weekstart:a},function(){f.resolve(d)}):e.get({weekstart:a,category:b},function(){f.resolve(d)}),f.promise}function m(a,b){var c=i.defer(),d=f.get({weekstart:a,category:b},function(){c.resolve(d)});return c.promise}a.isopen1=!0,a.isopen2=!0,a.isopen3=!0;var n=new Date(h.dt);a.category=h.category,a.weekStart=g.dateFormat(g.weekStart(n),"MM-DD-YYYY");var o=g.dateFormat(g.weekStart(n),"YYYYMMDD");i.all([k(o,h.category),l(o,h.category),m(o,h.category)]).then(function(b){a.deliverytotal=b[0].totals,0==b[0].totals&&(a.isopen1=!1),a.chart=b[0].dailytotals,a.chartOptions={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b[0].category,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b[0].days}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:j}},a.faileddeliverytotal=b[1].totals,0==b[1].totals&&(a.isopen2=!1),a.chart2=b[1].dailytotals,a.chartOptions2={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b[1].category,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b[1].days}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:j}},a.failedreasonstotal=b[2].totals,0==b[2].totals&&(a.isopen3=!1),a.chart3=b[2].dailytotals,a.chartOptions3={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b[2].exception,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b[2].days}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:j}}})}]);var weeklyControllers=angular.module("weeklyControllers",[]);weeklyControllers.controller("WeeklyCtrl",["$scope","WeeklyCategoryTotals","WeeklyCategoryFailedTotals","WeeklyServiceTotals","WeeklyServiceFailedTotals","WeeklyFailedReasonTotals","DateUtil","$routeParams","$q",function(a,b,c,d,e,f,g,h,i){function j(a,b,c,d){return d.series[b].label+", "+d.data[b][c]}function k(a,c){var e,f=i.defer();return e="All"==c?b.get({year:a.getFullYear(),month:a.getMonth()+1},function(){f.resolve(e)}):d.get({year:a.getFullYear(),month:a.getMonth()+1,category:c},function(){f.resolve(e)}),f.promise}function l(a,b){var d,f=i.defer();return d="All"==b?c.get({year:a.getFullYear(),month:a.getMonth()+1},function(){f.resolve(d)}):e.get({year:a.getFullYear(),month:a.getMonth()+1,category:b},function(){f.resolve(d)}),f.promise}function m(a,b){var c=i.defer(),d=f.get({year:a.getFullYear(),month:a.getMonth()+1,category:b},function(){c.resolve(d)});return c.promise}a.isopen1=!0,a.isopen2=!0,a.isopen3=!0;var n=new Date(h.dt);a.category=h.category,a.date=n,a.year=n.getFullYear(),a.month=n.getMonth()+1,a.monthyear=g.dateFormat(n,"MM-YYYY"),i.all([k(n,h.category),l(n,h.category),m(n,h.category)]).then(function(b){a.deliverytotal=b[0].totals,0==b[0].totals&&(a.isopen1=!1),a.chart=b[0].weeklytotals,a.chartOptions={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b[0].category,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b[0].weekstart}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:j}},a.faileddeliverytotal=b[1].totals,0==b[1].totals&&(a.isopen2=!1),a.chart2=b[1].weeklytotals,a.chartOptions2={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b[1].category,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b[1].weekstart}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:j}},a.failedreasonstotal=b[2].totals,0==b[2].totals&&(a.isopen3=!1),a.chart3=b[2].weeklytotals,a.chartOptions3={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b[2].exception,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b[2].weekstart}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:j}}})}]);var monthlyControllers=angular.module("monthlyControllers",[]);monthlyControllers.controller("MonthlyCtrl",["$scope","MonthlyCategoryTotals","MonthlyCategoryFailedTotals","MonthlyServiceTotals","MonthlyServiceFailedTotals","MonthlyFailedReasonTotals","$routeParams","$q",function(a,b,c,d,e,f,g,h){function i(a,b,c,d){return d.series[b].label+", "+d.data[b][c]}function j(a,c){var e,f=h.defer();return e="All"==c?b.get({year:a.getFullYear()},function(){f.resolve(e)}):d.get({year:a.getFullYear(),category:c},function(){f.resolve(e)}),f.promise}function k(a,b){var d,f=h.defer();return d="All"==b?c.get({year:a.getFullYear()},function(){f.resolve(d)}):e.get({year:a.getFullYear(),category:b},function(){f.resolve(d)}),f.promise}function l(a,b){var c=h.defer(),d=f.get({year:a.getFullYear(),category:b},function(){c.resolve(d)});return c.promise}a.isopen1=!0,a.isopen2=!0,a.isopen3=!0;var m=new Date(g.dt);a.category=g.category,a.year=m.getFullYear(),h.all([j(m,g.category),k(m,g.category),l(m,g.category)]).then(function(b){a.deliverytotal=b[0].totals,0==b[0].totals&&(a.isopen1=!1),a.chart=b[0].monthlytotals,a.chartOptions={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b[0].category,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b[0].months}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:i}},a.faileddeliverytotal=b[1].totals,0==b[1].totals&&(a.isopen2=!1),a.chart2=b[1].monthlytotals,a.chartOptions2={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b[1].category,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b[1].months}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:i}},a.failedreasonstotal=b[2].totals,0==b[2].totals&&(a.isopen3=!1),a.chart3=b[2].monthlytotals,a.chartOptions3={stackSeries:!0,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{fillToZero:!0}},series:b[2].exception,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:b[2].months}},highlighter:{show:!0,showTooltip:!0,tooltipLocation:"ne",tooltipContentEditor:i}}})}]);var monthlyService=angular.module("monthlyService",["ngResource"]);monthlyService.factory("MonthlyCategoryTotals",["$resource",function(a){return a("monthlytotalsbycategory/:year",{},{})}]),monthlyService.factory("MonthlyCategoryFailedTotals",["$resource",function(a){return a("monthlyfailedtotalsbycategory/:year",{},{})}]),monthlyService.factory("MonthlyServiceTotals",["$resource",function(a){return a("monthlytotalsbyservice/:year/:category",{},{})}]),monthlyService.factory("MonthlyServiceFailedTotals",["$resource",function(a){return a("monthlyfailedtotalsbyservice/:year/:category",{},{})}]),monthlyService.factory("MonthlyFailedReasonTotals",["$resource",function(a){return a("monthlyfailedreasontotalsbyexception/:year/:category",{},{})}]);var weeklyService=angular.module("weeklyService",["ngResource"]);weeklyService.factory("WeeklyCategoryTotals",["$resource",function(a){return a("weeklytotalsbycategory/:year/:month",{},{})}]),weeklyService.factory("WeeklyCategoryFailedTotals",["$resource",function(a){return a("weeklyfailedtotalsbycategory/:year/:month",{},{})}]),weeklyService.factory("WeeklyServiceTotals",["$resource",function(a){return a("weeklytotalsbyservice/:year/:month/:category",{},{})}]),weeklyService.factory("WeeklyServiceFailedTotals",["$resource",function(a){return a("weeklyfailedtotalsbyservice/:year/:month/:category",{},{})}]),weeklyService.factory("WeeklyFailedReasonTotals",["$resource",function(a){return a("weeklyfailedreasontotalsbyexception/:year/:month/:category",{},{})}]);var dailyService=angular.module("dailyService",["ngResource"]);dailyService.factory("DailyCategoryTotals",["$resource",function(a){return a("dailytotalsbycategory/:weekstart",{},{})}]),dailyService.factory("DailyCategoryFailedTotals",["$resource",function(a){return a("dailyfailedtotalsbycategory/:weekstart",{},{})}]),dailyService.factory("DailyServiceTotals",["$resource",function(a){return a("dailytotalsbyservice/:weekstart/:category",{},{})}]),dailyService.factory("DailyServiceFailedTotals",["$resource",function(a){return a("dailyfailedtotalsbyservice/:weekstart/:category",{},{})}]),dailyService.factory("DailyFailedReasonTotals",["$resource",function(a){return a("dailyfailedreasontotalsbyexception/:weekstart/:category",{},{})}]);var indexService=angular.module("indexService",["ngResource"]);indexService.factory("ServiceCategories",["$resource",function(a){return a("servicecategories",{},{})}]),indexService.factory("Services",["$resource",function(a){return a("services",{},{})}]);var app=angular.module("utilService",[]);app.service("DateUtil",function(){this.dateFormat=function(a,b){return b=b.replace("DD",(a.getDate()<10?"0":"")+a.getDate()),b=b.replace("MM",(a.getMonth()<9?"0":"")+(a.getMonth()+1)),b=b.replace("YYYY",a.getFullYear())},this.weekStart=function(a){var b=a.getFullYear(),c=a.getMonth(),d=a.getDate()-a.getDay();d>a.getDate()&&(c--,0==a.getMonth()&&b--);var e=new Date;return e.setFullYear(b),e.setMonth(c),e.setDate(d),e},this.weekEnd=function(a){var b=a.getFullYear(),c=a.getMonth(),d=a.getDate()+(6-a.getDay());d<a.getDate()&&(c++,12==a.getMonth()&&b++);var e=new Date;return e.setFullYear(b),e.setMonth(c),e.setDate(d),e}});